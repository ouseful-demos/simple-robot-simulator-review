
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>1. Robot Control &#8212; Robot Simulators Review  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Robot Simulators Review</a></h1>



<p class="blurb">Robot simulator review</p>






<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../RobotSimulators.html">Robot Simulators</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5.5ex;
    padding-top: 0.3rem;
    padding-right: 0.3rem;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 0.3rem;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="1.-Robot-Control">
<h1>1. Robot Control<a class="headerlink" href="#1.-Robot-Control" title="Permalink to this headline">¶</a></h1>
<p><strong>[COPIED FROM Doug Blank’s</strong><a class="reference external" href="https://jupyter.brynmawr.edu/services/public/dblank/CS110%20Intro%20to%20Computing/2017-Spring/Lectures/Robot%20Control.ipynb">Bryn Mawr CS110 Intro to Computing course</a><strong>]</strong></p>
<p>For this assignment, we will write Java code in Processing to control a simulated robot.</p>
<p>The robot can be seen from above in its 2D contained world:</p>
<p>The robot is very simple, but can be programmed to do many things.</p>
<div class="section" id="1.1-Sensors">
<h2>1.1 Sensors<a class="headerlink" href="#1.1-Sensors" title="Permalink to this headline">¶</a></h2>
<p>The simulated robot has the following methods and properties:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">getIR(VALUE)</span></code> - where VALUE is 0 for right/front, 1 for left/front; returns 0 to 1</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">takePicture()</span></code> - returns a <a class="reference external" href="http://processingjs.org/reference/PImage/">PImage</a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stalled</span></code> - is a boolean value (<code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>)</p></li>
</ul>
<p>IR stands for “infrared”. There are two simulated IR sensors on the front of the robot. They return values between 0 and 1. 1 means that nothing has been detected, and anything less means that there is an obstacle in front of the sensor. These aren’t very good sensors (the same kind of inexpensive sensors in restrooms for detecting when to flush, and when to dispense paper towels). Example:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getIR</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// object on right, front</span>
<span class="o">}</span>
<span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getIR</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// object on left, front</span>
<span class="o">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">takePicture()</span></code> returns a <a class="reference external" href="http://processingjs.org/reference/PImage/">PImage</a> object. We will explore those in the next assignment.</p>
<p><code class="docutils literal notranslate"><span class="pre">stalled</span></code> is a boolean property of the robot. Example:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">stalled</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// robot can&#39;t move</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="1.2-Movements">
<h2>1.2 Movements<a class="headerlink" href="#1.2-Movements" title="Permalink to this headline">¶</a></h2>
<p>The simulated robot has the following methods for moving the robot:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">forward(VALUE)</span></code> - VALUE should be between 0 and 1.0, or larger for small FPS</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">backward(VALUE)</span></code> - VALUE should be between 0 and 1.0, or larger for small FPS</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">turn(VALUE)</span></code> - VALUE could be between .01 and .1 (left); negative to turn right</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop()</span></code> - make the robot stop both turning and translating. Same as forward(0), turn(0)</p></li>
</ul>
<p>As with sensors, when you refer to any of these, you need to preface with them with <code class="docutils literal notranslate"><span class="pre">this</span></code>. Examples:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="k">this</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="mf">1.0</span><span class="o">);</span>
<span class="k">this</span><span class="o">.</span><span class="na">backward</span><span class="o">(</span><span class="mf">1.0</span><span class="o">);</span>
<span class="k">this</span><span class="o">.</span><span class="na">turn</span><span class="o">(</span><span class="mf">.01</span><span class="o">);</span>
<span class="k">this</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
</pre></div>
</div>
<p>We put together sensing and movement to create a robot brain.</p>
</div>
<div class="section" id="1.3-The-Robot-Brain">
<h2>1.3 The Robot Brain<a class="headerlink" href="#1.3-The-Robot-Brain" title="Permalink to this headline">¶</a></h2>
<p>To control a robot, you need to use a special class. However, we want to define a method called <code class="docutils literal notranslate"><span class="pre">brain</span></code> in this class. In order to do this, we <strong>extend</strong> the class.</p>
<p>The class Robot exists. We extend it by defining a new class called <code class="docutils literal notranslate"><span class="pre">MyRobot</span></code> that has its own constructor and method brain.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">MyRobot</span> <span class="kd">extends</span> <span class="n">Robot</span> <span class="o">{</span>
    <span class="n">MyRobot</span><span class="o">(</span><span class="kt">float</span> <span class="n">x</span><span class="o">,</span> <span class="kt">float</span> <span class="n">y</span><span class="o">,</span> <span class="kt">float</span> <span class="n">d</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">d</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kt">void</span> <span class="nf">brain</span><span class="o">()</span> <span class="o">{</span>
        <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Thus, to make a robot run around in the simulated world, we need to:</p>
<ol class="arabic simple">
<li><p>define our robot class, by extending the existing Robot class</p></li>
<li><p>create an instance of our class</p></li>
<li><p>add the robot to the simulated world</p></li>
<li><p>call <code class="docutils literal notranslate"><span class="pre">world.update()</span></code> repeatedly</p></li>
</ol>
<p>A <code class="docutils literal notranslate"><span class="pre">setup()</span></code> function might look like this:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Set up canvas 500, 250 for World, 128 for camera:</span>
    <span class="n">size</span><span class="o">(</span><span class="mi">500</span><span class="o">,</span> <span class="mi">250</span> <span class="o">+</span> <span class="mi">128</span><span class="o">);</span>
    <span class="c1">// Set rate so it doesn&#39;t overwhelm your browser:</span>
    <span class="n">frameRate</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
    <span class="c1">// Create a simulated world:</span>
    <span class="n">world</span> <span class="o">=</span> <span class="k">new</span> <span class="n">World</span><span class="o">(</span><span class="mi">500</span><span class="o">,</span> <span class="mi">250</span><span class="o">);</span>
    <span class="c1">// Create robot, and add to world:</span>
    <span class="n">robot</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyRobot</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="n">world</span><span class="o">.</span><span class="na">addRobot</span><span class="o">(</span><span class="n">robot</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>And a <code class="docutils literal notranslate"><span class="pre">draw()</span></code> function might look like this:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Clear:</span>
    <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span>
    <span class="c1">// Run simulation for one step:</span>
    <span class="n">world</span><span class="o">.</span><span class="na">update</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="1.4-Finite-State-Machine">
<h2>1.4 Finite State Machine<a class="headerlink" href="#1.4-Finite-State-Machine" title="Permalink to this headline">¶</a></h2>
<p>To program the robot, we will use a technique very similar to how you programmed your objects from last week. This is called a <a class="reference external" href="https://en.wikipedia.org/wiki/Finite-state_machine">Finite State Machine</a> or FSM.</p>
<p>An FSM can be represented by circles (states) and arrows that take you from one state to another based on some event or property. For example, example the following FSM:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-java notranslate"><div class="highlight"><pre>
<span></span>#%%dot
#magic and dependencies not installed
digraph finite_state_machine {
    rankdir=LR;
    size=&quot;8,5&quot;
    node [shape = circle] backward forward &quot;start turn left&quot; &quot;turn left&quot;;
    &quot;start turn left&quot; -&gt; &quot;turn left&quot; [ label = &quot;start timer&quot; ];
    &quot;turn left&quot; -&gt; &quot;turn left&quot; [label = &quot;while time left&quot;];
    &quot;turn left&quot; -&gt; forward [ label = &quot;out of time!&quot; ];
    forward -&gt; backward [ label = &quot;stall&quot; ];
    backward -&gt; forward [ label = &quot;stall&quot; ];
    forward -&gt; forward;
    backward -&gt; backward;
}
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.26.0 (20091210.2329)
 -->
<!-- Title: finite_state_machine Pages: 1 -->
<svg width="510pt" height="282pt"
 viewBox="0.00 0.00 510.00 282.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph1" class="graph" transform="scale(1 1) rotate(0) translate(4 278)">
<title>finite_state_machine</title>
<polygon fill="white" stroke="white" points="-4,5 -4,-278 507,-278 507,5 -4,5"/>
<!-- backward -->
<g id="node1" class="node"><title>backward</title>
<ellipse fill="none" stroke="black" cx="267" cy="-207" rx="48.7904" ry="48.7904"/>
<text text-anchor="middle" x="267" y="-203.9" font-family="Times Roman,serif" font-size="14.00">backward</text>
</g>
<!-- backward&#45;&gt;backward -->
<g id="edge14" class="edge"><title>backward&#45;&gt;backward</title>
<path fill="none" stroke="black" d="M249.158,-252.72C250.178,-264.829 256.125,-274 267,-274 274.646,-274 279.857,-269.466 282.631,-262.565"/>
<polygon fill="black" stroke="black" points="286.065,-263.244 284.842,-252.72 279.236,-261.71 286.065,-263.244"/>
</g>
<!-- forward -->
<g id="node2" class="node"><title>forward</title>
<ellipse fill="none" stroke="black" cx="460" cy="-165" rx="41.2167" ry="41.7193"/>
<text text-anchor="middle" x="460" y="-161.9" font-family="Times Roman,serif" font-size="14.00">forward</text>
</g>
<!-- backward&#45;&gt;forward -->
<g id="edge10" class="edge"><title>backward&#45;&gt;forward</title>
<path fill="none" stroke="black" d="M315.704,-200.825C341.038,-197.141 372.398,-191.838 400,-185 403.624,-184.102 407.343,-183.09 411.069,-182.01"/>
<polygon fill="black" stroke="black" points="412.337,-185.283 420.886,-179.023 410.3,-178.586 412.337,-185.283"/>
<text text-anchor="middle" x="367" y="-203.4" font-family="Times Roman,serif" font-size="14.00">stall</text>
</g>
<!-- forward&#45;&gt;backward -->
<g id="edge8" class="edge"><title>forward&#45;&gt;backward</title>
<path fill="none" stroke="black" d="M418.635,-159.826C393.654,-158.044 361.447,-158.151 334,-166 327.891,-167.747 321.786,-170.216 315.886,-173.087"/>
<polygon fill="black" stroke="black" points="314.019,-170.115 306.813,-177.883 317.29,-176.304 314.019,-170.115"/>
<text text-anchor="middle" x="367" y="-172.4" font-family="Times Roman,serif" font-size="14.00">stall</text>
</g>
<!-- forward&#45;&gt;forward -->
<g id="edge12" class="edge"><title>forward&#45;&gt;forward</title>
<path fill="none" stroke="black" d="M442.754,-202.449C442.931,-214.472 448.68,-224 460,-224 467.783,-224 472.932,-219.496 475.448,-212.775"/>
<polygon fill="black" stroke="black" points="478.978,-212.902 477.246,-202.449 472.082,-211.701 478.978,-212.902"/>
</g>
<!-- start turn left -->
<g id="node3" class="node"><title>start turn left</title>
<ellipse fill="none" stroke="black" cx="62" cy="-61" rx="61.0181" ry="61.5183"/>
<text text-anchor="middle" x="62" y="-57.9" font-family="Times Roman,serif" font-size="14.00">start turn left</text>
</g>
<!-- turn left -->
<g id="node4" class="node"><title>turn left</title>
<ellipse fill="none" stroke="black" cx="267" cy="-61" rx="41.9273" ry="42.4264"/>
<text text-anchor="middle" x="267" y="-57.9" font-family="Times Roman,serif" font-size="14.00">turn left</text>
</g>
<!-- start turn left&#45;&gt;turn left -->
<g id="edge2" class="edge"><title>start turn left&#45;&gt;turn left</title>
<path fill="none" stroke="black" d="M123.507,-61C152.37,-61 186.426,-61 214.115,-61"/>
<polygon fill="black" stroke="black" points="214.392,-64.5001 224.392,-61 214.392,-57.5001 214.392,-64.5001"/>
<text text-anchor="middle" x="171" y="-67.4" font-family="Times Roman,serif" font-size="14.00">start timer</text>
</g>
<!-- turn left&#45;&gt;forward -->
<g id="edge6" class="edge"><title>turn left&#45;&gt;forward</title>
<path fill="none" stroke="black" d="M304.671,-81.2991C336.056,-98.2115 380.867,-122.358 414.299,-140.374"/>
<polygon fill="black" stroke="black" points="412.943,-143.619 423.406,-145.281 416.264,-137.456 412.943,-143.619"/>
<text text-anchor="middle" x="367" y="-137.4" font-family="Times Roman,serif" font-size="14.00">out of time!</text>
</g>
<!-- turn left&#45;&gt;turn left -->
<g id="edge4" class="edge"><title>turn left&#45;&gt;turn left</title>
<path fill="none" stroke="black" d="M249.004,-99.0841C249.189,-111.31 255.188,-121 267,-121 275.306,-121 280.737,-116.209 283.294,-109.115"/>
<polygon fill="black" stroke="black" points="286.774,-109.529 284.996,-99.0841 279.872,-108.358 286.774,-109.529"/>
<text text-anchor="middle" x="267" y="-127.4" font-family="Times Roman,serif" font-size="14.00">while time left</text>
</g>
</g>
</svg></div>
</div>
<p>In English that says:</p>
<ul class="simple">
<li><p>if you are in the “start turn left”, then:</p></li>
<li><p>start timer</p></li>
<li><p>goto “turn left” state</p></li>
<li><p>if you are in the “turn left” state</p></li>
<li><p>decrease timer</p></li>
<li><p>if timer &lt; 0, goto “forward” state</p></li>
<li><p>if you are in “forward” state:</p></li>
<li><p>if stalled, goto “backward” state</p></li>
<li><p>if you are in “backward” state</p></li>
<li><p>if stalled, goto “forward” state</p></li>
</ul>
<p>Here is that same algorithm in Java, and shown starting in “start turn left”:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">MyRobot</span> <span class="kd">extends</span> <span class="n">Robot</span> <span class="o">{</span>
    <span class="n">MyRobot</span><span class="o">(</span><span class="kt">float</span> <span class="n">x</span><span class="o">,</span> <span class="kt">float</span> <span class="n">y</span><span class="o">,</span> <span class="kt">float</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">r</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="s">&quot;start turn left&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kt">void</span> <span class="nf">brain</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">float</span> <span class="n">speed</span> <span class="o">=</span> <span class="mf">3.0</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">==</span> <span class="s">&quot;backward&quot;</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">stalled</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="s">&quot;forward&quot;</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">speed</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">backward</span><span class="o">(</span><span class="n">speed</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">==</span> <span class="s">&quot;forward&quot;</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">stalled</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="s">&quot;backward&quot;</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">backward</span><span class="o">(</span><span class="n">speed</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">speed</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">==</span> <span class="s">&quot;start turn left&quot;</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">time</span> <span class="o">=</span> <span class="mi">62</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="s">&quot;turn left&quot;</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">==</span> <span class="s">&quot;turn left&quot;</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">time</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">turn</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="s">&quot;forward&quot;</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">turn</span><span class="o">(</span><span class="mf">.05</span><span class="o">);</span>
                <span class="k">this</span><span class="o">.</span><span class="na">time</span> <span class="o">-=</span> <span class="mi">1</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">==</span> <span class="s">&quot;turn right&quot;</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">turn</span><span class="o">(-</span><span class="mf">.05</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>To run the robot simulation in Jupyter or in your down downloaded Processing, you will need the following three files:</p>
<ol class="arabic simple">
<li><p><a class="reference external" href="https://athena.brynmawr.edu/jupyter/hub/dblank/public/CS110%20Intro%20to%20Computing/2015-Fall/Lectures/Robot.pde">Robot.pde</a></p></li>
<li><p><a class="reference external" href="https://athena.brynmawr.edu/jupyter/hub/dblank/public/CS110%20Intro%20to%20Computing/2015-Fall/Lectures/Hit.pde">Hit.pde</a></p></li>
<li><p><a class="reference external" href="https://athena.brynmawr.edu/jupyter/hub/dblank/public/CS110%20Intro%20to%20Computing/2015-Fall/Lectures/World.pde">World.pde</a></p></li>
</ol>
<p>In Jupyter, you can get those files with the %download magic:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-java notranslate"><div class="highlight"><pre>
<span></span>#Already downloaded
#%download https://jupyter.brynmawr.edu/jupyter/hub/dblank/public/CS110%20Intro%20to%20Computing/2015-Fall/Lectures/Robot.pde
#%download https://jupyter.brynmawr.edu/jupyter/hub/dblank/public/CS110%20Intro%20to%20Computing/2015-Fall/Lectures/Hit.pde
#%download https://jupyter.brynmawr.edu/jupyter/hub/dblank/public/CS110%20Intro%20to%20Computing/2015-Fall/Lectures/World.pde
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Downloaded &#39;Robot.pde&#39;.
Downloaded &#39;Hit.pde&#39;.
Downloaded &#39;World.pde&#39;.
</pre></div></div>
</div>
<p>And then simply use the %include magic as shown below.</p>
<p>Finally, let’s run an example. Notice that you can also click and drag the robot:</p>
<ul class="simple">
<li><p>drag left to move forward</p></li>
<li><p>drag right to move backward</p></li>
<li><p>drag up to turn left</p></li>
<li><p>drag down to turn right</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-java notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="n">include</span> <span class="n">Robot</span><span class="o">.</span><span class="na">pde</span>
<span class="o">%</span><span class="n">include</span> <span class="n">Hit</span><span class="o">.</span><span class="na">pde</span>
<span class="o">%</span><span class="n">include</span> <span class="n">World</span><span class="o">.</span><span class="na">pde</span>

<span class="n">Robot</span> <span class="n">robot</span><span class="o">;</span>
<span class="n">World</span> <span class="n">world</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">mx</span><span class="o">,</span> <span class="n">my</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">MyRobot</span> <span class="kd">extends</span> <span class="n">Robot</span> <span class="o">{</span>
    <span class="n">MyRobot</span><span class="o">(</span><span class="kt">float</span> <span class="n">x</span><span class="o">,</span> <span class="kt">float</span> <span class="n">y</span><span class="o">,</span> <span class="kt">float</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">r</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="s">&quot;go&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kt">void</span> <span class="nf">brain</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">PImage</span> <span class="n">pic</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">takePicture</span><span class="o">();</span>
        <span class="c1">// Show pic on canvas:</span>
        <span class="n">image</span><span class="o">(</span><span class="n">pic</span><span class="o">,</span> <span class="mi">500</span> <span class="o">-</span> <span class="mi">256</span><span class="o">,</span> <span class="mi">250</span><span class="o">);</span>
        <span class="n">fill</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">text</span><span class="o">(</span><span class="s">&quot;getIR(0): &quot;</span> <span class="o">+</span> <span class="n">nf</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getIR</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">265</span><span class="o">);</span>
        <span class="n">text</span><span class="o">(</span><span class="s">&quot;getIR(1): &quot;</span> <span class="o">+</span> <span class="n">nf</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getIR</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">280</span><span class="o">);</span>
        <span class="n">text</span><span class="o">(</span><span class="s">&quot;stalled: &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">stalled</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">295</span><span class="o">);</span>
        <span class="n">text</span><span class="o">(</span><span class="s">&quot;state: &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">state</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">310</span><span class="o">);</span>
        <span class="n">text</span><span class="o">(</span><span class="s">&quot;time: &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">time</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">325</span><span class="o">);</span>

        <span class="c1">// brain!</span>

        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">==</span> <span class="s">&quot;stop&quot;</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Set up canvas 500, 250 for World, 128 for camera:</span>
    <span class="n">size</span><span class="o">(</span><span class="mi">500</span><span class="o">,</span> <span class="mi">250</span> <span class="o">+</span> <span class="mi">128</span><span class="o">);</span>
    <span class="c1">// Set rate so it doesn&#39;t overwhelm your browser:</span>
    <span class="n">frameRate</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
    <span class="c1">// Create a simulated world:</span>
    <span class="n">world</span> <span class="o">=</span> <span class="k">new</span> <span class="n">World</span><span class="o">(</span><span class="mi">500</span><span class="o">,</span> <span class="mi">250</span><span class="o">);</span>
    <span class="n">world</span><span class="o">.</span><span class="na">addWall</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">110</span><span class="o">,</span> <span class="mi">110</span><span class="o">);</span>
    <span class="n">world</span><span class="o">.</span><span class="na">addBox</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span> <span class="mi">95</span><span class="o">,</span> <span class="mi">210</span><span class="o">,</span> <span class="mi">170</span><span class="o">,</span> <span class="n">color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">255</span><span class="o">));</span>
    <span class="n">world</span><span class="o">.</span><span class="na">addBox</span><span class="o">(</span><span class="mi">300</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">310</span><span class="o">,</span> <span class="mi">95</span><span class="o">,</span> <span class="n">color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">255</span><span class="o">,</span> <span class="mi">0</span><span class="o">));</span>
    <span class="n">world</span><span class="o">.</span><span class="na">addBox</span><span class="o">(</span><span class="mi">300</span><span class="o">,</span> <span class="mi">190</span><span class="o">,</span> <span class="mi">310</span><span class="o">,</span> <span class="mi">240</span><span class="o">,</span> <span class="n">color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">128</span><span class="o">,</span> <span class="mi">0</span><span class="o">));</span>
    <span class="c1">// Create robot, and add to world:</span>
    <span class="n">robot</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyRobot</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="n">world</span><span class="o">.</span><span class="na">addRobot</span><span class="o">(</span><span class="n">robot</span><span class="o">);</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Clear:</span>
    <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span>
    <span class="c1">// Run simulation for one step:</span>
    <span class="n">world</span><span class="o">.</span><span class="na">update</span><span class="o">();</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">mousePressed</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">robot</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="s">&quot;go&quot;</span><span class="o">;</span>
    <span class="n">mx</span> <span class="o">=</span> <span class="n">mouseX</span><span class="o">;</span>
    <span class="n">my</span> <span class="o">=</span> <span class="n">mouseY</span><span class="o">;</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">mouseDragged</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">robot</span><span class="o">.</span><span class="na">forward</span><span class="o">((</span><span class="n">mouseX</span> <span class="o">-</span> <span class="n">mx</span><span class="o">)/</span><span class="mf">100.0</span><span class="o">);</span>
    <span class="n">robot</span><span class="o">.</span><span class="na">turn</span><span class="o">(-(</span><span class="n">mouseY</span> <span class="o">-</span> <span class="n">my</span><span class="o">)/</span><span class="mf">1000.0</span><span class="o">);</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">mouseReleased</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">//robot.stop();</span>
    <span class="n">robot</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="s">&quot;stop&quot;</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

        var component = document.getElementById("sketch_1");
        if (component != undefined)
            component.remove();
        component = document.getElementById("state_1");
        if (component != undefined)
            component.remove();
        component = document.getElementById("controls_div_1");
        if (component != undefined)
            component.remove();
        require([window.location.protocol + "//calysto.github.io/javascripts/processing/processing.js"], function() {
            // FIXME: Stop all previously running versions (?)
            var processingInstance = Processing.getInstanceById("canvas_1");
            if (processingInstance != undefined && processingInstance.isRunning())
                processingInstance.noLoop();
        });

</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div id="canvas_div_1">
  <b>Sketch #1:</b><br/>
  <canvas id="canvas_1"></canvas><br/>
</div>
<div id="controls_div_1">
  <button id="run_button_1" onclick="startSketch('1');">
    <i class="fa fa-play-circle-o" style="size: 2em;"></i>
        Run
  </button>
  <button id="pause_button_1" onclick="pauseSketch('1');">
    <i class="fa fa-pause" style="size: 2em;"></i>
        Pause
  </button>
  <button id="setup_button_1" onclick="setupSketch('1');">
    setup()
  </button>
  <button id="draw_button_1" onclick="drawSketch('1');">
    draw()
  </button>
</div>
<b>Sketch #1 state:</b> <span id="state_1">Loading...</span><br/>
<script>

function change_button(button, disable) {
    button.disabled = disable;
    if (disable) {
        button.style.color = "grey";
    } else {
        button.style.color = "black";
    }
}

function startSketch(id) {
    switchSketchState(id, true);
}

function pauseSketch(id) {
    switchSketchState(id, false);
}

function drawSketch(id) {
    var processingInstance = Processing.getInstanceById("canvas_" + id);
    if (processingInstance != undefined) {
        if (processingInstance.draw != undefined) {
            document.getElementById("state_" + id).innerHTML = "Drawing...";
            try {
                processingInstance.redraw();
                document.getElementById("state_" + id).innerHTML = "Drawing... done! Paused.";
                document.getElementById("state_" + id).style.color = "blue";
            } catch (e) {
                processingInstance.println(e.toString());
                document.getElementById("state_" + id).innerHTML = e.toString();
                document.getElementById("state_" + id).style.color = "red";
            }
        } else {
            document.getElementById("state_" + id).innerHTML = "No drawing() function. Paused.";
            document.getElementById("state_" + id).style.color = "blue";
        }
    } else {
        document.getElementById("state_" + id).innerHTML = "Error.";
        document.getElementById("state_" + id).style.color = "red";
    }
    change_button(document.getElementById("run_button_" + id), processingInstance.draw == undefined);
    change_button(document.getElementById("pause_button_" + id), true);
    change_button(document.getElementById("setup_button_" + id), processingInstance.setup == undefined);
    change_button(document.getElementById("draw_button_" + id), processingInstance.draw == undefined);
}

function setupSketch(id) {
    var processingInstance = Processing.getInstanceById("canvas_" + id);
    if (processingInstance != undefined) {
        if (processingInstance.setup != undefined) {
            document.getElementById("state_" + id).innerHTML = "Setting up...";
            try {
                processingInstance.setup();
                document.getElementById("state_" + id).innerHTML = "Setting up... done! Paused.";
                document.getElementById("state_" + id).style.color = "blue";
            } catch (e) {
                processingInstance.println(e.toString());
                document.getElementById("state_" + id).innerHTML = e.toString();
                document.getElementById("state_" + id).style.color = "red";
            }
        } else {
            document.getElementById("state_" + id).innerHTML = "No setup() function. Paused.";
            document.getElementById("state_" + id).style.color = "blue";
        }
    } else {
        document.getElementById("state_" + id).innerHTML = "Error.";
        document.getElementById("state_" + id).style.color = "red";
    }
    change_button(document.getElementById("run_button_" + id), processingInstance.draw == undefined);
    change_button(document.getElementById("pause_button_" + id), true);
    change_button(document.getElementById("setup_button_" + id), processingInstance.setup == undefined);
    change_button(document.getElementById("draw_button_" + id), processingInstance.draw == undefined);
}

function switchSketchState(id, on) {
    var processingInstance = Processing.getInstanceById("canvas_" + id);
    if (on) {
        document.getElementById("state_" + id).innerHTML = "Running...";
        document.getElementById("state_" + id).style.color = "green";
        change_button(document.getElementById("run_button_" + id), true);
        change_button(document.getElementById("pause_button_" + id), processingInstance.draw == undefined);
        change_button(document.getElementById("setup_button_" + id),  true);
        change_button(document.getElementById("draw_button_" + id), true);
        processingInstance.loop();  // call Processing loop() function
    } else {
        document.getElementById("state_" + id).innerHTML = "Paused.";
        document.getElementById("state_" + id).style.color = "blue";
        change_button(document.getElementById("run_button_" + id), processingInstance.draw == undefined);
        change_button(document.getElementById("pause_button_" + id), true);
        change_button(document.getElementById("setup_button_" + id), processingInstance.setup == undefined);
        change_button(document.getElementById("draw_button_" + id), processingInstance.draw == undefined);
        processingInstance.noLoop(); // stop animation, call noLoop()
    }
}

require([window.location.protocol + "//calysto.github.io/javascripts/processing/processing.js"], function () {
    var processingCode = 'class World {\n    float scale = 250;\n    float at_x = 0;\n    float at_y = 0;\n    float w;\n    float h;\n    ArrayList<Robot> robots = new ArrayList<Robot>();\n    ArrayList<ArrayList<PVector>> walls = new ArrayList<ArrayList<PVector>>();\n    ArrayList<Integer> colors = new ArrayList<Integer>();\n    World(int w, int h) {\n        this.w = w; \n        this.h = h;\n        this.addWall(color(128, 0, 128), \n                     new PVector(0.0, 0.0),\n                     new PVector(this.w, 0.0),\n                     new PVector(this.w, 10.0),\n                     new PVector(0, 10.0));\n        this.addWall(color(128, 0, 128), \n                     new PVector(0, 0),\n                     new PVector(0, this.h),\n                     new PVector(10, this.h),\n                     new PVector(10, 0));\n        this.addWall(color(128, 0, 128), \n                     new PVector(0.0, this.h - 10.0),\n                     new PVector(0.0, this.h),\n                     new PVector(this.w, this.h),\n                     new PVector(this.w, this.h - 10.0)\n                     );\n        this.addWall(color(128, 0, 128), \n                     new PVector(this.w - 10.0, 0.0),\n                     new PVector(this.w, 0.0),\n                     new PVector(this.w, this.h),\n                     new PVector(this.w - 10.0, this.h));\n    }\n    void addBox(float x1, float y1, float x2, float y2, Integer col) {\n      // add to world, scaled\n      x1 = x1/this.w * this.w;\n      y1 = y1/this.h * this.h;\n      x2 = x2/this.w * this.w;\n      y2 = y2/this.h * this.h;\n      this.addWall(col, \n                     new PVector(x1, y1),\n                     new PVector(x2, y1),\n                     new PVector(x2, y2),\n                     new PVector(x1, y2));\n    }\n    void addWall(float x1, float y1, float x2, float y2) {\n      // add to world, scaled\n      this.addBox(x1, y1, x2, y2, color(128, 0, 128));\n    }\n    \n    void setScale(float s) {\n      // scale the world... > 1 make it bigger\n      this.scale = s * 250;\n    }\n      \n    void addWall(color c, PVector v1, PVector v2, PVector v3, PVector v4) {\n        this.colors.add(c);\n        ArrayList<PVector> wall = new ArrayList();\n        wall.add(v1);\n        wall.add(v2);\n        wall.add(v3);\n        wall.add(v4);\n        this.walls.add(wall);\n    }\n    void addRobot(Robot robot) {\n      // scale the robot\'s position to this world:\n      robot.x = robot.x/this.w * this.w;\n      robot.y = robot.y/this.h * this.h;\n      this.robots.add(robot);\n      robot.world = this;\n    }\n    void update() {\n        noStroke();\n        fill(0, 128, 0);\n        rect(this.at_x, this.at_y, this.w, this.h); \n        int count = 0;\n        for (ArrayList<PVector> wall: this.walls) {\n            color c = (color)this.colors.get(count);\n            fill(c);\n            beginShape();\n            for (PVector v: wall) {\n                vertex(v.x, v.y);\n            }\n            endShape();\n            count++;\n        }\n        for (Robot robot: this.robots) {\n            robot.update();\n            robot.draw();\n        }\n    }\n}\nclass Hit {\n    float distance;\n    float x;\n    float y;\n    float start_x;\n    float start_y;\n    color col;\n    Hit(float x, float y, float distance, color col, \n        float start_x, float start_y) {\n      this.x = x;\n      this.y = y;\n      this.distance = distance;\n      this.col = col;\n      this.start_x = start_x;\n      this.start_y = start_y;\n    }\n}\n\nclass Robot {\n  float x;\n  float y;\n  float direction;\n  boolean debug = false;\n  float vx = 0.0; // velocity in x direction\n  float vy = 0.0; // velocity in y direction\n  float va = 0.0; // turn velocity\n  World world;\n  // sensors \n  boolean stalled = false;\n  String state = "forward";\n  float time = 0;\n  float[][] bounding_box = new float[4][2];\n  color robot_color = color(255, 0, 0);\n  Hit[] ir_sensors = new Hit[2];\n  float max_ir = 50;\n  Hit[] camera = new Hit[256];\n  boolean cam = false;\n\n  Robot() {\n    this.x = -1;\n    this.y = -1;\n    this.direction = 0;\n    this.state = "forward";\n  }\n  Robot(float x, float y, float direction) {\n    this.x = x;\n    this.y = y;\n    this.direction = direction;\n    this.state = "forward";\n  }\n  void forward(float vx) {\n    this.vx = vx;\n  }\n  void backward(float vx) {\n    this.vx = -vx;\n  }\n  float getIR(int pos) {\n    // 0 is on right, front\n    // 1 is on left, front\n    if (this.ir_sensors[pos] != null) {\n      return this.ir_sensors[pos].distance/(this.max_ir/250.0 * this.world.scale);\n    } else {\n      return 1.0;\n    }\n  }\n  PImage takePicture() {\n    PImage pic = new PImage(256, 128);\n    float size = max(this.world.w, this.world.h);\n    for (int i=0; i<this.camera.length; i++) {\n      Hit hit = this.camera[i];\n      float high;\n      Integer hcolor = null;\n      if (hit != null) {\n        float s = max(min(1.0 - hit.distance/size, 1.0), 0.0);\n        float r = red(hit.col);\n        float g = green(hit.col);\n        float b = blue(hit.col);\n        hcolor = color(r * s, g * s, b * s);\n        high = (1.0 - s) * 128;\n        //pg.line(i, 0 + high/2, i, 128 - high/2);\n      } else {\n        high = 0;\n      }\n      for (int j = 0; j < 128; j++) {\n        if (j < high/2) { //256 - high/2.0) { // sky\n          pic.set(i, j, color(0, 0, 128));\n        } else if (j < 128 - high/2) { //256 - high && hcolor != null) { // hit\n        if (hcolor != null)\n          pic.set(i, j, hcolor);\n        } else { // ground\n          pic.set(i, j, color(0, 128, 0));\n        }\n      }\n    }\n    return pic;\n  }\n  void turn(float va) {\n    this.va = va;\n  }\n  void stop() {\n    this.vx = 0.0;\n    this.vy = 0.0;\n    this.va = 0.0;\n  }\n  boolean ccw(float ax, float ay, \n  float bx, float by, \n  float cx, float cy) {\n    // counter clockwise\n    return (((cy - ay) * (bx - ax)) > ((by - ay) * (cx - ax)));\n  }\n  boolean intersect(float ax, float ay, \n  float bx, float by, \n  float cx, float cy, \n  float dx, float dy) {\n    // Return true if line segments AB and CD intersect\n    return (this.ccw(ax, ay, cx, cy, dx, dy) != this.ccw(bx, by, cx, cy, dx, dy) && \n      this.ccw(ax, ay, bx, by, cx, cy) != this.ccw(ax, ay, bx, by, dx, dy));\n  }\n\n  float[] coefs(float p1x, float p1y, float p2x, float p2y) {\n    float A = (p1y - p2y);\n    float B = (p2x - p1x);\n    float C = (p1x * p2y - p2x * p1y);\n    return new float[] {\n      A, B, -C\n    };\n  }\n\n  float[] intersect_coefs(float L1_0, float L1_1, float L1_2, \n  float L2_0, float L2_1, float L2_2) {\n    float D  = L1_0 * L2_1 - L1_1 * L2_0;\n    float Dx = L1_2 * L2_1 - L1_1 * L2_2;\n    float Dy = L1_0 * L2_2 - L1_2 * L2_0;\n    if (D != 0) {\n      float x1 = Dx / D;\n      float y1 = Dy / D;\n      return new float[] {\n        x1, y1\n      };\n    } else {\n      return null;\n    }\n  }\n  float[] intersect_hit(float p1x, float p1y, float p2x, float p2y, \n  float p3x, float p3y, float p4x, float p4y ) {\n    // http://stackoverflow.com/questions/20677795/find-the-point-of-intersecting-lines\n    float[] L1 = coefs(p1x, p1y, p2x, p2y);\n    float[] L2 = coefs(p3x, p3y, p4x, p4y);\n    float[] xy = intersect_coefs(L1[0], L1[1], L1[2], \n    L2[0], L2[1], L2[2]);\n    // now check to see on both segments:\n    if (xy != null) {\n      float lowx = min(p1x, p2x) - .1;\n      float highx = max(p1x, p2x) + .1;\n      float lowy = min(p1y, p2y) - .1;\n      float highy = max(p1y, p2y) + .1;\n      if (lowx <= xy[0] && xy[0] <= highx && \n        lowy <= xy[1] && xy[1] <= highy) {\n        lowx = min(p3x, p4x) - .1;\n        highx = max(p3x, p4x) + .1;\n        lowy = min(p3y, p4y) - .1;\n        highy = max(p3y, p4y) + .1;\n        if (lowx <= xy[0] && xy[0] <= highx && \n          lowy <= xy[1] && xy[1] <= highy) {\n          return xy;\n        }\n      }\n    }\n    return null;\n  }\n  float distance(float x1, float y1, float x2, float y2) {\n    return sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2));\n  } \n  Hit castRay(float x1, float y1, float a, float maxRange) {\n    ArrayList<Hit> hits = new ArrayList<Hit>();\n    float x2 = sin(a) * maxRange + x1;\n    float y2 = cos(a) * maxRange + y1;\n    int count = 0;\n    for (ArrayList<PVector> wall : this.world.walls) {\n      // if intersection, can\'t move\n      PVector v1 = wall.get(0);\n      PVector v2 = wall.get(1);\n      PVector v3 = wall.get(2);\n      PVector v4 = wall.get(3);\n      float[] pos = this.intersect_hit(x1, y1, x2, y2, \n      v1.x, v1.y, v2.x, v2.y);\n      if (pos != null) {\n        color col = this.world.colors.get(count);\n        float dist = this.distance(pos[0], pos[1], x1, y1);\n        hits.add(new Hit(pos[0], pos[1], dist, col, x1, y1));\n      }\n      pos = this.intersect_hit(x1, y1, x2, y2, \n      v2.x, v2.y, v3.x, v3.y);\n      if (pos != null) {\n        color col = this.world.colors.get(count);\n        float dist = this.distance(pos[0], pos[1], x1, y1);\n        hits.add(new Hit(pos[0], pos[1], dist, col, x1, y1));\n      }\n      pos = this.intersect_hit(x1, y1, x2, y2, \n      v3.x, v3.y, v4.x, v4.y);\n      if (pos != null) {\n        color col = this.world.colors.get(count);\n        float dist = this.distance(pos[0], pos[1], x1, y1);\n        hits.add(new Hit(pos[0], pos[1], dist, col, x1, y1));\n      }\n      pos = this.intersect_hit(x1, y1, x2, y2, \n      v4.x, v4.y, v1.x, v1.y);\n      if (pos != null) {\n        color col = this.world.colors.get(count);\n        float dist = this.distance(pos[0], pos[1], x1, y1);\n        hits.add(new Hit(pos[0], pos[1], dist, col, x1, y1));\n      }\n      count++;\n    }\n    if (hits.size() == 0) {\n      return null;\n    } else {\n      return min_hit(hits);\n    }\n  }\n  Hit min_hit(ArrayList<Hit> hits) {\n    Hit minimum = hits.get(0);\n    for (Hit hit : hits) {\n      if (hit.distance < minimum.distance) {\n        minimum = hit;\n      }\n    }\n    return minimum;\n  }\n  void brain() {\n    // will be overridden\n  }\n  void update() {\n    this.brain();\n    float scale = this.world.scale;\n    //this.direction += PI/180;\n    float tvx = this.vx * sin(-this.direction + PI/2) + this.vy * cos(-this.direction + PI/2);\n    float tvy = this.vx * cos(-this.direction + PI/2) - this.vy * sin(-this.direction + PI/2);\n    // proposed positions:\n    float px = this.x + tvx/250.0 * scale; \n    float py = this.y + tvy/250.0 * scale; \n    float pdirection = this.direction - this.va; \n    // check to see if collision\n    // bounding box:\n    float[] p1 = rotateAround(px, py, 30/250.0 * scale, pdirection + PI/4 + 0 * PI/2);\n    float[] p2 = rotateAround(px, py, 30/250.0 * scale, pdirection + PI/4 + 1 * PI/2);\n    float[] p3 = rotateAround(px, py, 30/250.0 * scale, pdirection + PI/4 + 2 * PI/2);\n    float[] p4 = rotateAround(px, py, 30/250.0 * scale, pdirection + PI/4 + 3 * PI/2);\n    this.bounding_box[0] = p1;\n    this.bounding_box[1] = p2;\n    this.bounding_box[2] = p3;\n    this.bounding_box[3] = p4;\n    this.stalled = false;\n    for (ArrayList<PVector> wall : this.world.walls) {\n      // if intersection, can\'t move\n      PVector v1 = wall.get(0);\n      PVector v2 = wall.get(1);\n      PVector v3 = wall.get(2);\n      PVector v4 = wall.get(3);\n      if ( // p1 to p2\n      this.intersect(p1[0], p1[1], p2[0], p2[1], \n      v1.x, v1.y, v2.x, v2.y) ||\n        this.intersect(p1[0], p1[1], p2[0], p2[1], \n      v2.x, v2.y, v3.x, v3.y) ||\n        this.intersect(p1[0], p1[1], p2[0], p2[1], \n      v3.x, v3.y, v4.x, v4.y) ||\n        this.intersect(p1[0], p1[1], p2[0], p2[1], \n      v4.x, v4.y, v1.x, v1.y) ||\n        // p2 to p3\n      this.intersect(p2[0], p2[1], p3[0], p3[1], \n      v1.x, v1.y, v2.x, v2.y) ||\n        this.intersect(p2[0], p2[1], p3[0], p3[1], \n      v2.x, v2.y, v3.x, v3.y) ||\n        this.intersect(p2[0], p2[1], p3[0], p3[1], \n      v3.x, v3.y, v4.x, v4.y) ||\n        this.intersect(p2[0], p2[1], p3[0], p3[1], \n      v4.x, v4.y, v1.x, v1.y) ||\n        // p3 to p4\n      this.intersect(p3[0], p3[1], p4[0], p4[1], \n      v1.x, v1.y, v2.x, v2.y) ||\n        this.intersect(p3[0], p3[1], p4[0], p4[1], \n      v2.x, v2.y, v3.x, v3.y) ||\n        this.intersect(p3[0], p3[1], p4[0], p4[1], \n      v3.x, v3.y, v4.x, v4.y) ||\n        this.intersect(p3[0], p3[1], p4[0], p4[1], \n      v4.x, v4.y, v1.x, v1.y) ||\n        // p4 to p1\n      this.intersect(p4[0], p4[1], p1[0], p1[1], \n      v1.x, v1.y, v2.x, v2.y) ||\n        this.intersect(p4[0], p4[1], p1[0], p1[1], \n      v2.x, v2.y, v3.x, v3.y) ||\n        this.intersect(p4[0], p4[1], p1[0], p1[1], \n      v3.x, v3.y, v4.x, v4.y) ||\n        this.intersect(p4[0], p4[1], p1[0], p1[1], \n      v4.x, v4.y, v1.x, v1.y)) {\n        this.stalled = true;\n        break;\n        //this.x = this.x - tvx/250.0 * scale; \n        //this.y = this.y - tvy/250.0 * scale;\n      }\n    }\n    if (! this.stalled) {\n      // if no intersection, make move\n      this.x = px; \n      this.y = py; \n      this.direction = pdirection; \n      if (tvx != 0 && random(1.0) < .01) {\n        //this.direction += random(.1) - .05; // a bit of noise\n      }\n    } else {\n      //this.direction += random(.2) - .1;\n    }\n    // update sensors, camera\n    // on right:\n    float[] p = rotateAround(this.x, this.y, 25/250.0 * scale, this.direction + PI/8);\n    Hit hit = this.castRay(p[0], p[1], -this.direction + PI/2.0, this.max_ir/250.0 * scale);\n    if (hit != null) {\n      if (this.debug) {\n        fill(0, 255, 0);\n        ellipse(p[0], p[1], 5, 5);\n        ellipse(hit.x, hit.y, 5, 5);\n      }\n      this.ir_sensors[0] = hit;\n    } else {\n      this.ir_sensors[0] = null;\n    }\n    p = rotateAround(this.x, this.y, 25/250.0 * scale, this.direction - PI/8);\n    hit = this.castRay(p[0], p[1], -this.direction + PI/2, this.max_ir/250.0 * scale);\n    if (hit != null) {\n      if (this.debug) {\n        fill(0, 0, 255);\n        ellipse(p[0], p[1], 5, 5);\n        ellipse(hit.x, hit.y, 5, 5);\n      }\n      this.ir_sensors[1] = hit;\n    } else {\n      this.ir_sensors[1] = null;\n    }\n    // camera:\n    for (int i=0; i<256; i++) {\n      float angle = i/256.0 * 60 - 30;  \n      this.camera[i] = this.castRay(this.x, this.y, -this.direction + PI/2.0 - angle*PI/180.0, 1000);\n    } \n  }\n  float[] rotateAround(float x1, float y1, float length, float angle) {\n    return new float[] {\n      x1 + length * cos(-angle), \n      y1 - length * sin(-angle)\n    };\n  }\n  void draw() {\n    float scale = this.world.scale;\n    float [] sx = new float[] {\n      0.05, 0.05, 0.07, 0.07, 0.09, 0.09, 0.07, \n      0.07, 0.05, 0.05, -0.05, -0.05, -0.07, \n      -0.08, -0.09, -0.09, -0.08, -0.07, -0.05, \n      -0.05\n    };\n    float [] sy = new float[] {\n      0.06, 0.08, 0.07, 0.06, 0.06, -0.06, -0.06, \n      -0.07, -0.08, -0.06, -0.06, -0.08, -0.07, \n      -0.06, -0.05, 0.05, 0.06, 0.07, 0.08, 0.06\n    };\n    if (this.debug) {\n      stroke(255);\n      // bounding box:\n      float[] p1 = rotateAround(this.x, this.y, 30/250.0 * scale, this.direction + PI/4.0 + 0 * PI/2.0);\n      float[] p2 = rotateAround(this.x, this.y, 30/250.0 * scale, this.direction + PI/4.0 + 1 * PI/2.0);\n      float[] p3 = rotateAround(this.x, this.y, 30/250.0 * scale, this.direction + PI/4.0 + 2 * PI/2.0);\n      float[] p4 = rotateAround(this.x, this.y, 30/250.0 * scale, this.direction + PI/4.0 + 3 * PI/2.0);\n      line(p1[0], p1[1], p2[0], p2[1]);\n      line(p2[0], p2[1], p3[0], p3[1]);\n      line(p3[0], p3[1], p4[0], p4[1]);\n      line(p4[0], p4[1], p1[0], p1[1]);\n    }\n    pushMatrix();\n    translate(this.x, this.y);\n    rotate(this.direction);\n    // body:\n    if (this.stalled) {\n      fill(128, 128, 128);\n      stroke(255);\n    } else {\n      fill(this.robot_color);\n      noStroke();\n    }\n    beginShape();\n    for (int i =0; i < sx.length; i++) {\n      vertex(sx[i] * scale, sy[i] * scale);\n    }\n    endShape();\n    noStroke();\n    // Draw wheels:\n    fill(0);\n    rect(-10/250.0 * scale, -23/250.0 * scale, 19/250.0 * scale, 5/250.0 * scale);\n    rect(-10/250.0 * scale, 18/250.0 * scale, 19/250.0 * scale, 5/250.0 * scale);\n    // hole:\n    fill(0, 64, 0);\n    ellipse(0, 0, 7/250.0 * scale, 7/250.0 * scale);\n    // fluke\n    fill(0, 64, 0);\n    rect(15/250.0 * scale, -10/250.0 * scale, 4/250.0 * scale, 19/250.0 * scale);\n    popMatrix();\n    // draw sensors\n    // right front IR\n    // position of start of sensor:\n    float[] p1 = rotateAround(this.x, this.y, 25/250.0 * scale, this.direction + PI/8);\n    // angle of sensor:\n    float[] p2 = rotateAround(p1[0], p1[1], this.getIR(0) * this.max_ir/250.0 * scale, this.direction);\n    float dist = this.distance(p1[0], p1[1], p2[0], p2[1]);\n    if (this.getIR(0) < 1.0) {\n      stroke(255);\n    }\n    fill(128, 0, 128, 64);\n    arc(p1[0], p1[1], dist * 2, dist * 2, \n    this.direction - .5, this.direction + .5);\n    // left front IR\n    p1 = rotateAround(this.x, this.y, 25/250.0 * scale, this.direction - PI/8);\n    p2 = rotateAround(p1[0], p1[1], this.getIR(1) * this.max_ir/250.0 * scale, this.direction);\n    dist = this.distance(p1[0], p1[1], p2[0], p2[1]);\n    if (this.getIR(1) < 1.0) {\n      stroke(255);\n    }\n    fill(128, 0, 128, 64);\n    arc(p1[0], p1[1], dist * 2, dist * 2, \n    this.direction - .5, this.direction + .5);\n  }\n}\n\n\n\nRobot robot;\nWorld world;\nint mx, my;\n\nclass MyRobot extends Robot {\n    MyRobot(float x, float y, float r) {\n        super(x, y, r);\n        this.state = "go";\n    }\n\n    void brain() {\n        PImage pic = this.takePicture();\n        // Show pic on canvas:\n        image(pic, 500 - 256, 250);\n        fill(0);\n        text("getIR(0): " + nf(this.getIR(0), 1, 4), 0, 265);\n        text("getIR(1): " + nf(this.getIR(1), 1, 4), 0, 280);\n        text("stalled: " + this.stalled, 0, 295);\n        text("state: " + this.state, 0, 310);\n        text("time: " + this.time, 0, 325);\n        \n        // brain!\n        \n        if (this.state == "stop") {\n            this.stop();\n        }\n    }\n}\n\nvoid setup() {\n    // Set up canvas 500, 250 for World, 128 for camera:\n    size(500, 250 + 128);\n    // Set rate so it doesn\'t overwhelm your browser:\n    frameRate(10);\n    // Create a simulated world:\n    world = new World(500, 250);\n    world.addWall(100, 0, 110, 110);  \n    world.addBox(200, 95, 210, 170, color(255, 0, 255));  \n    world.addBox(300, 10, 310, 95, color(255, 255, 0));  \n    world.addBox(300, 190, 310, 240, color(255, 128, 0));  \n    // Create robot, and add to world:\n    robot = new MyRobot(400, 100, 0);\n    world.addRobot(robot);\n}\n\nvoid draw() {\n    // Clear:\n    background(255);\n    // Run simulation for one step:\n    world.update();\n}\n\nvoid mousePressed() {\n    robot.state = "go";\n    mx = mouseX;\n    my = mouseY;\n}\n\nvoid mouseDragged() {\n    robot.forward((mouseX - mx)/100.0);\n    robot.turn(-(mouseY - my)/1000.0);\n}\n\nvoid mouseReleased() {\n    //robot.stop();\n    robot.state = "stop";\n}';
    var cc;
    var processingInstance;
    var has_error = false;
    try {
        cc = Processing.compile(processingCode);
    } catch (e) {
        console.log(e);
        cc = Processing.compile("println('" + e.toString() + "');");
        document.getElementById("state_1").innerHTML = e.toString();
        document.getElementById("state_1").style.color = "red";
        has_error = true;
    }
    if (cc != undefined) {
        try {
            processingInstance = new Processing("canvas_1", cc);
        } catch (e) {
            console.log(e);
            cc = Processing.compile("println('" + e.toString() + "');");
            document.getElementById("state_1").innerHTML = e.toString();
            document.getElementById("state_1").style.color = "red";
            processingInstance = new Processing("canvas_1", cc);
            has_error = true;
        }
    }
    if (processingInstance != undefined) {
        setTimeout(function () {
            // Canvas:
            if (processingInstance.externals.context === undefined) {
                document.getElementById("canvas_div_1").style.display = "none";
            }
        }, 100);
        // Controls:
        if (!(processingInstance.isRunning() && processingInstance.draw != undefined)) {
            document.getElementById("controls_div_1").style.display = "none";
        }
        if (processingInstance.draw != undefined) {
            if (!has_error) {
                document.getElementById("state_1").innerHTML = "Running...";
                document.getElementById("state_1").style.color = "green";
            }
            change_button(document.getElementById("run_button_1"), true);
            change_button(document.getElementById("pause_button_1"), false);
            change_button(document.getElementById("setup_button_1"),  true);
            change_button(document.getElementById("draw_button_1"), true);
        } else {
            if (!has_error) {
                document.getElementById("state_1").innerHTML = "Done.";
                document.getElementById("state_1").style.color = "blue";
            }
            change_button(document.getElementById("run_button_1"), true);
            change_button(document.getElementById("pause_button_1"), true);
            change_button(document.getElementById("setup_button_1"),  processingInstance.setup == undefined);
            change_button(document.getElementById("draw_button_1"), true);
        }
    } else {
        document.getElementById("canvas_div_1").style.display = "none";
        document.getElementById("controls_div_1").style.display = "none";
        if (!has_error) {
            document.getElementById("state_1").innerHTML = "Error.";
            document.getElementById("state_1").style.color = "red";
        }
        change_button(document.getElementById("run_button_1"), true);
        change_button(document.getElementById("pause_button_1"), true);
        change_button(document.getElementById("setup_button_1"),  true);
        change_button(document.getElementById("draw_button_1"), true);
    }
});

</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-java notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="n">include</span> <span class="n">Robot</span><span class="o">.</span><span class="na">pde</span>
<span class="o">%</span><span class="n">include</span> <span class="n">Hit</span><span class="o">.</span><span class="na">pde</span>
<span class="o">%</span><span class="n">include</span> <span class="n">World</span><span class="o">.</span><span class="na">pde</span>

<span class="n">Robot</span> <span class="n">robot</span><span class="o">;</span>
<span class="n">World</span> <span class="n">world</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">mx</span><span class="o">,</span> <span class="n">my</span><span class="o">;</span>

<span class="kd">class</span> <span class="nc">MyRobot</span> <span class="kd">extends</span> <span class="n">Robot</span> <span class="o">{</span>
    <span class="n">MyRobot</span><span class="o">(</span><span class="kt">float</span> <span class="n">x</span><span class="o">,</span> <span class="kt">float</span> <span class="n">y</span><span class="o">,</span> <span class="kt">float</span> <span class="n">r</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">r</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="s">&quot;start turn left&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kt">void</span> <span class="nf">brain</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">PImage</span> <span class="n">pic</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">takePicture</span><span class="o">();</span>
        <span class="c1">// Show pic on canvas:</span>
        <span class="n">image</span><span class="o">(</span><span class="n">pic</span><span class="o">,</span> <span class="mi">500</span> <span class="o">-</span> <span class="mi">256</span><span class="o">,</span> <span class="mi">250</span><span class="o">);</span>
        <span class="n">fill</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">text</span><span class="o">(</span><span class="s">&quot;getIR(0): &quot;</span> <span class="o">+</span> <span class="n">nf</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getIR</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">265</span><span class="o">);</span>
        <span class="n">text</span><span class="o">(</span><span class="s">&quot;getIR(1): &quot;</span> <span class="o">+</span> <span class="n">nf</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">getIR</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">),</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">280</span><span class="o">);</span>
        <span class="n">text</span><span class="o">(</span><span class="s">&quot;stalled: &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">stalled</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">295</span><span class="o">);</span>
        <span class="n">text</span><span class="o">(</span><span class="s">&quot;state: &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">state</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">310</span><span class="o">);</span>
        <span class="n">text</span><span class="o">(</span><span class="s">&quot;time: &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">time</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">325</span><span class="o">);</span>

        <span class="c1">// brain:</span>

        <span class="kt">float</span> <span class="n">speed</span> <span class="o">=</span> <span class="mf">3.0</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">==</span> <span class="s">&quot;backward&quot;</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">stalled</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="s">&quot;forward&quot;</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">speed</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">backward</span><span class="o">(</span><span class="n">speed</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">==</span> <span class="s">&quot;forward&quot;</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">stalled</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="s">&quot;backward&quot;</span><span class="o">;</span>
                <span class="k">this</span><span class="o">.</span><span class="na">backward</span><span class="o">(</span><span class="n">speed</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">forward</span><span class="o">(</span><span class="n">speed</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">==</span> <span class="s">&quot;start turn left&quot;</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">time</span> <span class="o">=</span> <span class="mi">62</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="s">&quot;turn left&quot;</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">==</span> <span class="s">&quot;turn left&quot;</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">time</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">turn</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
                <span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">=</span> <span class="s">&quot;forward&quot;</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">this</span><span class="o">.</span><span class="na">turn</span><span class="o">(</span><span class="mf">.05</span><span class="o">);</span>
                <span class="k">this</span><span class="o">.</span><span class="na">time</span> <span class="o">-=</span> <span class="mi">1</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">==</span> <span class="s">&quot;turn right&quot;</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">turn</span><span class="o">(-</span><span class="mf">.05</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">state</span> <span class="o">==</span> <span class="s">&quot;stop&quot;</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//this.stop();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Set up canvas 500, 250 for World, 128 for camera:</span>
    <span class="n">size</span><span class="o">(</span><span class="mi">500</span><span class="o">,</span> <span class="mi">250</span> <span class="o">+</span> <span class="mi">128</span><span class="o">);</span>
    <span class="c1">// Set rate so it doesn&#39;t overwhelm your browser:</span>
    <span class="n">frameRate</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>
    <span class="c1">// Create a simulated world:</span>
    <span class="n">world</span> <span class="o">=</span> <span class="k">new</span> <span class="n">World</span><span class="o">(</span><span class="mi">500</span><span class="o">,</span> <span class="mi">250</span><span class="o">);</span>
    <span class="n">world</span><span class="o">.</span><span class="na">addWall</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">110</span><span class="o">,</span> <span class="mi">110</span><span class="o">);</span>
    <span class="n">world</span><span class="o">.</span><span class="na">addBox</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span> <span class="mi">95</span><span class="o">,</span> <span class="mi">210</span><span class="o">,</span> <span class="mi">170</span><span class="o">,</span> <span class="n">color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">255</span><span class="o">));</span>
    <span class="n">world</span><span class="o">.</span><span class="na">addBox</span><span class="o">(</span><span class="mi">300</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">310</span><span class="o">,</span> <span class="mi">95</span><span class="o">,</span> <span class="n">color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">255</span><span class="o">,</span> <span class="mi">0</span><span class="o">));</span>
    <span class="n">world</span><span class="o">.</span><span class="na">addBox</span><span class="o">(</span><span class="mi">300</span><span class="o">,</span> <span class="mi">190</span><span class="o">,</span> <span class="mi">310</span><span class="o">,</span> <span class="mi">240</span><span class="o">,</span> <span class="n">color</span><span class="o">(</span><span class="mi">255</span><span class="o">,</span> <span class="mi">128</span><span class="o">,</span> <span class="mi">0</span><span class="o">));</span>
    <span class="c1">// Create robot, and add to world:</span>
    <span class="n">robot</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MyRobot</span><span class="o">(</span><span class="mi">400</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="n">world</span><span class="o">.</span><span class="na">addRobot</span><span class="o">(</span><span class="n">robot</span><span class="o">);</span>
<span class="o">}</span>

<span class="kt">void</span> <span class="nf">draw</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Clear:</span>
    <span class="n">background</span><span class="o">(</span><span class="mi">255</span><span class="o">);</span>
    <span class="c1">// Run simulation for one step:</span>
    <span class="n">world</span><span class="o">.</span><span class="na">update</span><span class="o">();</span>
<span class="o">}</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

        var component = document.getElementById("sketch_2");
        if (component != undefined)
            component.remove();
        component = document.getElementById("state_2");
        if (component != undefined)
            component.remove();
        component = document.getElementById("controls_div_2");
        if (component != undefined)
            component.remove();
        require([window.location.protocol + "//calysto.github.io/javascripts/processing/processing.js"], function() {
            // FIXME: Stop all previously running versions (?)
            var processingInstance = Processing.getInstanceById("canvas_2");
            if (processingInstance != undefined && processingInstance.isRunning())
                processingInstance.noLoop();
        });

</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div id="canvas_div_2">
  <b>Sketch #2:</b><br/>
  <canvas id="canvas_2"></canvas><br/>
</div>
<div id="controls_div_2">
  <button id="run_button_2" onclick="startSketch('2');">
    <i class="fa fa-play-circle-o" style="size: 2em;"></i>
        Run
  </button>
  <button id="pause_button_2" onclick="pauseSketch('2');">
    <i class="fa fa-pause" style="size: 2em;"></i>
        Pause
  </button>
  <button id="setup_button_2" onclick="setupSketch('2');">
    setup()
  </button>
  <button id="draw_button_2" onclick="drawSketch('2');">
    draw()
  </button>
</div>
<b>Sketch #2 state:</b> <span id="state_2">Loading...</span><br/>
<script>

function change_button(button, disable) {
    button.disabled = disable;
    if (disable) {
        button.style.color = "grey";
    } else {
        button.style.color = "black";
    }
}

function startSketch(id) {
    switchSketchState(id, true);
}

function pauseSketch(id) {
    switchSketchState(id, false);
}

function drawSketch(id) {
    var processingInstance = Processing.getInstanceById("canvas_" + id);
    if (processingInstance != undefined) {
        if (processingInstance.draw != undefined) {
            document.getElementById("state_" + id).innerHTML = "Drawing...";
            try {
                processingInstance.redraw();
                document.getElementById("state_" + id).innerHTML = "Drawing... done! Paused.";
                document.getElementById("state_" + id).style.color = "blue";
            } catch (e) {
                processingInstance.println(e.toString());
                document.getElementById("state_" + id).innerHTML = e.toString();
                document.getElementById("state_" + id).style.color = "red";
            }
        } else {
            document.getElementById("state_" + id).innerHTML = "No drawing() function. Paused.";
            document.getElementById("state_" + id).style.color = "blue";
        }
    } else {
        document.getElementById("state_" + id).innerHTML = "Error.";
        document.getElementById("state_" + id).style.color = "red";
    }
    change_button(document.getElementById("run_button_" + id), processingInstance.draw == undefined);
    change_button(document.getElementById("pause_button_" + id), true);
    change_button(document.getElementById("setup_button_" + id), processingInstance.setup == undefined);
    change_button(document.getElementById("draw_button_" + id), processingInstance.draw == undefined);
}

function setupSketch(id) {
    var processingInstance = Processing.getInstanceById("canvas_" + id);
    if (processingInstance != undefined) {
        if (processingInstance.setup != undefined) {
            document.getElementById("state_" + id).innerHTML = "Setting up...";
            try {
                processingInstance.setup();
                document.getElementById("state_" + id).innerHTML = "Setting up... done! Paused.";
                document.getElementById("state_" + id).style.color = "blue";
            } catch (e) {
                processingInstance.println(e.toString());
                document.getElementById("state_" + id).innerHTML = e.toString();
                document.getElementById("state_" + id).style.color = "red";
            }
        } else {
            document.getElementById("state_" + id).innerHTML = "No setup() function. Paused.";
            document.getElementById("state_" + id).style.color = "blue";
        }
    } else {
        document.getElementById("state_" + id).innerHTML = "Error.";
        document.getElementById("state_" + id).style.color = "red";
    }
    change_button(document.getElementById("run_button_" + id), processingInstance.draw == undefined);
    change_button(document.getElementById("pause_button_" + id), true);
    change_button(document.getElementById("setup_button_" + id), processingInstance.setup == undefined);
    change_button(document.getElementById("draw_button_" + id), processingInstance.draw == undefined);
}

function switchSketchState(id, on) {
    var processingInstance = Processing.getInstanceById("canvas_" + id);
    if (on) {
        document.getElementById("state_" + id).innerHTML = "Running...";
        document.getElementById("state_" + id).style.color = "green";
        change_button(document.getElementById("run_button_" + id), true);
        change_button(document.getElementById("pause_button_" + id), processingInstance.draw == undefined);
        change_button(document.getElementById("setup_button_" + id),  true);
        change_button(document.getElementById("draw_button_" + id), true);
        processingInstance.loop();  // call Processing loop() function
    } else {
        document.getElementById("state_" + id).innerHTML = "Paused.";
        document.getElementById("state_" + id).style.color = "blue";
        change_button(document.getElementById("run_button_" + id), processingInstance.draw == undefined);
        change_button(document.getElementById("pause_button_" + id), true);
        change_button(document.getElementById("setup_button_" + id), processingInstance.setup == undefined);
        change_button(document.getElementById("draw_button_" + id), processingInstance.draw == undefined);
        processingInstance.noLoop(); // stop animation, call noLoop()
    }
}

require([window.location.protocol + "//calysto.github.io/javascripts/processing/processing.js"], function () {
    var processingCode = 'class World {\n    float scale = 250;\n    float at_x = 0;\n    float at_y = 0;\n    float w;\n    float h;\n    ArrayList<Robot> robots = new ArrayList<Robot>();\n    ArrayList<ArrayList<PVector>> walls = new ArrayList<ArrayList<PVector>>();\n    ArrayList<Integer> colors = new ArrayList<Integer>();\n    World(int w, int h) {\n        this.w = w; \n        this.h = h;\n        this.addWall(color(128, 0, 128), \n                     new PVector(0.0, 0.0),\n                     new PVector(this.w, 0.0),\n                     new PVector(this.w, 10.0),\n                     new PVector(0, 10.0));\n        this.addWall(color(128, 0, 128), \n                     new PVector(0, 0),\n                     new PVector(0, this.h),\n                     new PVector(10, this.h),\n                     new PVector(10, 0));\n        this.addWall(color(128, 0, 128), \n                     new PVector(0.0, this.h - 10.0),\n                     new PVector(0.0, this.h),\n                     new PVector(this.w, this.h),\n                     new PVector(this.w, this.h - 10.0)\n                     );\n        this.addWall(color(128, 0, 128), \n                     new PVector(this.w - 10.0, 0.0),\n                     new PVector(this.w, 0.0),\n                     new PVector(this.w, this.h),\n                     new PVector(this.w - 10.0, this.h));\n    }\n    void addBox(float x1, float y1, float x2, float y2, Integer col) {\n      // add to world, scaled\n      x1 = x1/this.w * this.w;\n      y1 = y1/this.h * this.h;\n      x2 = x2/this.w * this.w;\n      y2 = y2/this.h * this.h;\n      this.addWall(col, \n                     new PVector(x1, y1),\n                     new PVector(x2, y1),\n                     new PVector(x2, y2),\n                     new PVector(x1, y2));\n    }\n    void addWall(float x1, float y1, float x2, float y2) {\n      // add to world, scaled\n      this.addBox(x1, y1, x2, y2, color(128, 0, 128));\n    }\n    \n    void setScale(float s) {\n      // scale the world... > 1 make it bigger\n      this.scale = s * 250;\n    }\n      \n    void addWall(color c, PVector v1, PVector v2, PVector v3, PVector v4) {\n        this.colors.add(c);\n        ArrayList<PVector> wall = new ArrayList();\n        wall.add(v1);\n        wall.add(v2);\n        wall.add(v3);\n        wall.add(v4);\n        this.walls.add(wall);\n    }\n    void addRobot(Robot robot) {\n      // scale the robot\'s position to this world:\n      robot.x = robot.x/this.w * this.w;\n      robot.y = robot.y/this.h * this.h;\n      this.robots.add(robot);\n      robot.world = this;\n    }\n    void update() {\n        noStroke();\n        fill(0, 128, 0);\n        rect(this.at_x, this.at_y, this.w, this.h); \n        int count = 0;\n        for (ArrayList<PVector> wall: this.walls) {\n            color c = (color)this.colors.get(count);\n            fill(c);\n            beginShape();\n            for (PVector v: wall) {\n                vertex(v.x, v.y);\n            }\n            endShape();\n            count++;\n        }\n        for (Robot robot: this.robots) {\n            robot.update();\n            robot.draw();\n        }\n    }\n}\nclass Hit {\n    float distance;\n    float x;\n    float y;\n    float start_x;\n    float start_y;\n    color col;\n    Hit(float x, float y, float distance, color col, \n        float start_x, float start_y) {\n      this.x = x;\n      this.y = y;\n      this.distance = distance;\n      this.col = col;\n      this.start_x = start_x;\n      this.start_y = start_y;\n    }\n}\n\nclass Robot {\n  float x;\n  float y;\n  float direction;\n  boolean debug = false;\n  float vx = 0.0; // velocity in x direction\n  float vy = 0.0; // velocity in y direction\n  float va = 0.0; // turn velocity\n  World world;\n  // sensors \n  boolean stalled = false;\n  String state = "forward";\n  float time = 0;\n  float[][] bounding_box = new float[4][2];\n  color robot_color = color(255, 0, 0);\n  Hit[] ir_sensors = new Hit[2];\n  float max_ir = 50;\n  Hit[] camera = new Hit[256];\n  boolean cam = false;\n\n  Robot() {\n    this.x = -1;\n    this.y = -1;\n    this.direction = 0;\n    this.state = "forward";\n  }\n  Robot(float x, float y, float direction) {\n    this.x = x;\n    this.y = y;\n    this.direction = direction;\n    this.state = "forward";\n  }\n  void forward(float vx) {\n    this.vx = vx;\n  }\n  void backward(float vx) {\n    this.vx = -vx;\n  }\n  float getIR(int pos) {\n    // 0 is on right, front\n    // 1 is on left, front\n    if (this.ir_sensors[pos] != null) {\n      return this.ir_sensors[pos].distance/(this.max_ir/250.0 * this.world.scale);\n    } else {\n      return 1.0;\n    }\n  }\n  PImage takePicture() {\n    PImage pic = new PImage(256, 128);\n    float size = max(this.world.w, this.world.h);\n    for (int i=0; i<this.camera.length; i++) {\n      Hit hit = this.camera[i];\n      float high;\n      Integer hcolor = null;\n      if (hit != null) {\n        float s = max(min(1.0 - hit.distance/size, 1.0), 0.0);\n        float r = red(hit.col);\n        float g = green(hit.col);\n        float b = blue(hit.col);\n        hcolor = color(r * s, g * s, b * s);\n        high = (1.0 - s) * 128;\n        //pg.line(i, 0 + high/2, i, 128 - high/2);\n      } else {\n        high = 0;\n      }\n      for (int j = 0; j < 128; j++) {\n        if (j < high/2) { //256 - high/2.0) { // sky\n          pic.set(i, j, color(0, 0, 128));\n        } else if (j < 128 - high/2) { //256 - high && hcolor != null) { // hit\n        if (hcolor != null)\n          pic.set(i, j, hcolor);\n        } else { // ground\n          pic.set(i, j, color(0, 128, 0));\n        }\n      }\n    }\n    return pic;\n  }\n  void turn(float va) {\n    this.va = va;\n  }\n  void stop() {\n    this.vx = 0.0;\n    this.vy = 0.0;\n    this.va = 0.0;\n  }\n  boolean ccw(float ax, float ay, \n  float bx, float by, \n  float cx, float cy) {\n    // counter clockwise\n    return (((cy - ay) * (bx - ax)) > ((by - ay) * (cx - ax)));\n  }\n  boolean intersect(float ax, float ay, \n  float bx, float by, \n  float cx, float cy, \n  float dx, float dy) {\n    // Return true if line segments AB and CD intersect\n    return (this.ccw(ax, ay, cx, cy, dx, dy) != this.ccw(bx, by, cx, cy, dx, dy) && \n      this.ccw(ax, ay, bx, by, cx, cy) != this.ccw(ax, ay, bx, by, dx, dy));\n  }\n\n  float[] coefs(float p1x, float p1y, float p2x, float p2y) {\n    float A = (p1y - p2y);\n    float B = (p2x - p1x);\n    float C = (p1x * p2y - p2x * p1y);\n    return new float[] {\n      A, B, -C\n    };\n  }\n\n  float[] intersect_coefs(float L1_0, float L1_1, float L1_2, \n  float L2_0, float L2_1, float L2_2) {\n    float D  = L1_0 * L2_1 - L1_1 * L2_0;\n    float Dx = L1_2 * L2_1 - L1_1 * L2_2;\n    float Dy = L1_0 * L2_2 - L1_2 * L2_0;\n    if (D != 0) {\n      float x1 = Dx / D;\n      float y1 = Dy / D;\n      return new float[] {\n        x1, y1\n      };\n    } else {\n      return null;\n    }\n  }\n  float[] intersect_hit(float p1x, float p1y, float p2x, float p2y, \n  float p3x, float p3y, float p4x, float p4y ) {\n    // http://stackoverflow.com/questions/20677795/find-the-point-of-intersecting-lines\n    float[] L1 = coefs(p1x, p1y, p2x, p2y);\n    float[] L2 = coefs(p3x, p3y, p4x, p4y);\n    float[] xy = intersect_coefs(L1[0], L1[1], L1[2], \n    L2[0], L2[1], L2[2]);\n    // now check to see on both segments:\n    if (xy != null) {\n      float lowx = min(p1x, p2x) - .1;\n      float highx = max(p1x, p2x) + .1;\n      float lowy = min(p1y, p2y) - .1;\n      float highy = max(p1y, p2y) + .1;\n      if (lowx <= xy[0] && xy[0] <= highx && \n        lowy <= xy[1] && xy[1] <= highy) {\n        lowx = min(p3x, p4x) - .1;\n        highx = max(p3x, p4x) + .1;\n        lowy = min(p3y, p4y) - .1;\n        highy = max(p3y, p4y) + .1;\n        if (lowx <= xy[0] && xy[0] <= highx && \n          lowy <= xy[1] && xy[1] <= highy) {\n          return xy;\n        }\n      }\n    }\n    return null;\n  }\n  float distance(float x1, float y1, float x2, float y2) {\n    return sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2));\n  } \n  Hit castRay(float x1, float y1, float a, float maxRange) {\n    ArrayList<Hit> hits = new ArrayList<Hit>();\n    float x2 = sin(a) * maxRange + x1;\n    float y2 = cos(a) * maxRange + y1;\n    int count = 0;\n    for (ArrayList<PVector> wall : this.world.walls) {\n      // if intersection, can\'t move\n      PVector v1 = wall.get(0);\n      PVector v2 = wall.get(1);\n      PVector v3 = wall.get(2);\n      PVector v4 = wall.get(3);\n      float[] pos = this.intersect_hit(x1, y1, x2, y2, \n      v1.x, v1.y, v2.x, v2.y);\n      if (pos != null) {\n        color col = this.world.colors.get(count);\n        float dist = this.distance(pos[0], pos[1], x1, y1);\n        hits.add(new Hit(pos[0], pos[1], dist, col, x1, y1));\n      }\n      pos = this.intersect_hit(x1, y1, x2, y2, \n      v2.x, v2.y, v3.x, v3.y);\n      if (pos != null) {\n        color col = this.world.colors.get(count);\n        float dist = this.distance(pos[0], pos[1], x1, y1);\n        hits.add(new Hit(pos[0], pos[1], dist, col, x1, y1));\n      }\n      pos = this.intersect_hit(x1, y1, x2, y2, \n      v3.x, v3.y, v4.x, v4.y);\n      if (pos != null) {\n        color col = this.world.colors.get(count);\n        float dist = this.distance(pos[0], pos[1], x1, y1);\n        hits.add(new Hit(pos[0], pos[1], dist, col, x1, y1));\n      }\n      pos = this.intersect_hit(x1, y1, x2, y2, \n      v4.x, v4.y, v1.x, v1.y);\n      if (pos != null) {\n        color col = this.world.colors.get(count);\n        float dist = this.distance(pos[0], pos[1], x1, y1);\n        hits.add(new Hit(pos[0], pos[1], dist, col, x1, y1));\n      }\n      count++;\n    }\n    if (hits.size() == 0) {\n      return null;\n    } else {\n      return min_hit(hits);\n    }\n  }\n  Hit min_hit(ArrayList<Hit> hits) {\n    Hit minimum = hits.get(0);\n    for (Hit hit : hits) {\n      if (hit.distance < minimum.distance) {\n        minimum = hit;\n      }\n    }\n    return minimum;\n  }\n  void brain() {\n    // will be overridden\n  }\n  void update() {\n    this.brain();\n    float scale = this.world.scale;\n    //this.direction += PI/180;\n    float tvx = this.vx * sin(-this.direction + PI/2) + this.vy * cos(-this.direction + PI/2);\n    float tvy = this.vx * cos(-this.direction + PI/2) - this.vy * sin(-this.direction + PI/2);\n    // proposed positions:\n    float px = this.x + tvx/250.0 * scale; \n    float py = this.y + tvy/250.0 * scale; \n    float pdirection = this.direction - this.va; \n    // check to see if collision\n    // bounding box:\n    float[] p1 = rotateAround(px, py, 30/250.0 * scale, pdirection + PI/4 + 0 * PI/2);\n    float[] p2 = rotateAround(px, py, 30/250.0 * scale, pdirection + PI/4 + 1 * PI/2);\n    float[] p3 = rotateAround(px, py, 30/250.0 * scale, pdirection + PI/4 + 2 * PI/2);\n    float[] p4 = rotateAround(px, py, 30/250.0 * scale, pdirection + PI/4 + 3 * PI/2);\n    this.bounding_box[0] = p1;\n    this.bounding_box[1] = p2;\n    this.bounding_box[2] = p3;\n    this.bounding_box[3] = p4;\n    this.stalled = false;\n    for (ArrayList<PVector> wall : this.world.walls) {\n      // if intersection, can\'t move\n      PVector v1 = wall.get(0);\n      PVector v2 = wall.get(1);\n      PVector v3 = wall.get(2);\n      PVector v4 = wall.get(3);\n      if ( // p1 to p2\n      this.intersect(p1[0], p1[1], p2[0], p2[1], \n      v1.x, v1.y, v2.x, v2.y) ||\n        this.intersect(p1[0], p1[1], p2[0], p2[1], \n      v2.x, v2.y, v3.x, v3.y) ||\n        this.intersect(p1[0], p1[1], p2[0], p2[1], \n      v3.x, v3.y, v4.x, v4.y) ||\n        this.intersect(p1[0], p1[1], p2[0], p2[1], \n      v4.x, v4.y, v1.x, v1.y) ||\n        // p2 to p3\n      this.intersect(p2[0], p2[1], p3[0], p3[1], \n      v1.x, v1.y, v2.x, v2.y) ||\n        this.intersect(p2[0], p2[1], p3[0], p3[1], \n      v2.x, v2.y, v3.x, v3.y) ||\n        this.intersect(p2[0], p2[1], p3[0], p3[1], \n      v3.x, v3.y, v4.x, v4.y) ||\n        this.intersect(p2[0], p2[1], p3[0], p3[1], \n      v4.x, v4.y, v1.x, v1.y) ||\n        // p3 to p4\n      this.intersect(p3[0], p3[1], p4[0], p4[1], \n      v1.x, v1.y, v2.x, v2.y) ||\n        this.intersect(p3[0], p3[1], p4[0], p4[1], \n      v2.x, v2.y, v3.x, v3.y) ||\n        this.intersect(p3[0], p3[1], p4[0], p4[1], \n      v3.x, v3.y, v4.x, v4.y) ||\n        this.intersect(p3[0], p3[1], p4[0], p4[1], \n      v4.x, v4.y, v1.x, v1.y) ||\n        // p4 to p1\n      this.intersect(p4[0], p4[1], p1[0], p1[1], \n      v1.x, v1.y, v2.x, v2.y) ||\n        this.intersect(p4[0], p4[1], p1[0], p1[1], \n      v2.x, v2.y, v3.x, v3.y) ||\n        this.intersect(p4[0], p4[1], p1[0], p1[1], \n      v3.x, v3.y, v4.x, v4.y) ||\n        this.intersect(p4[0], p4[1], p1[0], p1[1], \n      v4.x, v4.y, v1.x, v1.y)) {\n        this.stalled = true;\n        break;\n        //this.x = this.x - tvx/250.0 * scale; \n        //this.y = this.y - tvy/250.0 * scale;\n      }\n    }\n    if (! this.stalled) {\n      // if no intersection, make move\n      this.x = px; \n      this.y = py; \n      this.direction = pdirection; \n      if (tvx != 0 && random(1.0) < .01) {\n        //this.direction += random(.1) - .05; // a bit of noise\n      }\n    } else {\n      //this.direction += random(.2) - .1;\n    }\n    // update sensors, camera\n    // on right:\n    float[] p = rotateAround(this.x, this.y, 25/250.0 * scale, this.direction + PI/8);\n    Hit hit = this.castRay(p[0], p[1], -this.direction + PI/2.0, this.max_ir/250.0 * scale);\n    if (hit != null) {\n      if (this.debug) {\n        fill(0, 255, 0);\n        ellipse(p[0], p[1], 5, 5);\n        ellipse(hit.x, hit.y, 5, 5);\n      }\n      this.ir_sensors[0] = hit;\n    } else {\n      this.ir_sensors[0] = null;\n    }\n    p = rotateAround(this.x, this.y, 25/250.0 * scale, this.direction - PI/8);\n    hit = this.castRay(p[0], p[1], -this.direction + PI/2, this.max_ir/250.0 * scale);\n    if (hit != null) {\n      if (this.debug) {\n        fill(0, 0, 255);\n        ellipse(p[0], p[1], 5, 5);\n        ellipse(hit.x, hit.y, 5, 5);\n      }\n      this.ir_sensors[1] = hit;\n    } else {\n      this.ir_sensors[1] = null;\n    }\n    // camera:\n    for (int i=0; i<256; i++) {\n      float angle = i/256.0 * 60 - 30;  \n      this.camera[i] = this.castRay(this.x, this.y, -this.direction + PI/2.0 - angle*PI/180.0, 1000);\n    } \n  }\n  float[] rotateAround(float x1, float y1, float length, float angle) {\n    return new float[] {\n      x1 + length * cos(-angle), \n      y1 - length * sin(-angle)\n    };\n  }\n  void draw() {\n    float scale = this.world.scale;\n    float [] sx = new float[] {\n      0.05, 0.05, 0.07, 0.07, 0.09, 0.09, 0.07, \n      0.07, 0.05, 0.05, -0.05, -0.05, -0.07, \n      -0.08, -0.09, -0.09, -0.08, -0.07, -0.05, \n      -0.05\n    };\n    float [] sy = new float[] {\n      0.06, 0.08, 0.07, 0.06, 0.06, -0.06, -0.06, \n      -0.07, -0.08, -0.06, -0.06, -0.08, -0.07, \n      -0.06, -0.05, 0.05, 0.06, 0.07, 0.08, 0.06\n    };\n    if (this.debug) {\n      stroke(255);\n      // bounding box:\n      float[] p1 = rotateAround(this.x, this.y, 30/250.0 * scale, this.direction + PI/4.0 + 0 * PI/2.0);\n      float[] p2 = rotateAround(this.x, this.y, 30/250.0 * scale, this.direction + PI/4.0 + 1 * PI/2.0);\n      float[] p3 = rotateAround(this.x, this.y, 30/250.0 * scale, this.direction + PI/4.0 + 2 * PI/2.0);\n      float[] p4 = rotateAround(this.x, this.y, 30/250.0 * scale, this.direction + PI/4.0 + 3 * PI/2.0);\n      line(p1[0], p1[1], p2[0], p2[1]);\n      line(p2[0], p2[1], p3[0], p3[1]);\n      line(p3[0], p3[1], p4[0], p4[1]);\n      line(p4[0], p4[1], p1[0], p1[1]);\n    }\n    pushMatrix();\n    translate(this.x, this.y);\n    rotate(this.direction);\n    // body:\n    if (this.stalled) {\n      fill(128, 128, 128);\n      stroke(255);\n    } else {\n      fill(this.robot_color);\n      noStroke();\n    }\n    beginShape();\n    for (int i =0; i < sx.length; i++) {\n      vertex(sx[i] * scale, sy[i] * scale);\n    }\n    endShape();\n    noStroke();\n    // Draw wheels:\n    fill(0);\n    rect(-10/250.0 * scale, -23/250.0 * scale, 19/250.0 * scale, 5/250.0 * scale);\n    rect(-10/250.0 * scale, 18/250.0 * scale, 19/250.0 * scale, 5/250.0 * scale);\n    // hole:\n    fill(0, 64, 0);\n    ellipse(0, 0, 7/250.0 * scale, 7/250.0 * scale);\n    // fluke\n    fill(0, 64, 0);\n    rect(15/250.0 * scale, -10/250.0 * scale, 4/250.0 * scale, 19/250.0 * scale);\n    popMatrix();\n    // draw sensors\n    // right front IR\n    // position of start of sensor:\n    float[] p1 = rotateAround(this.x, this.y, 25/250.0 * scale, this.direction + PI/8);\n    // angle of sensor:\n    float[] p2 = rotateAround(p1[0], p1[1], this.getIR(0) * this.max_ir/250.0 * scale, this.direction);\n    float dist = this.distance(p1[0], p1[1], p2[0], p2[1]);\n    if (this.getIR(0) < 1.0) {\n      stroke(255);\n    }\n    fill(128, 0, 128, 64);\n    arc(p1[0], p1[1], dist * 2, dist * 2, \n    this.direction - .5, this.direction + .5);\n    // left front IR\n    p1 = rotateAround(this.x, this.y, 25/250.0 * scale, this.direction - PI/8);\n    p2 = rotateAround(p1[0], p1[1], this.getIR(1) * this.max_ir/250.0 * scale, this.direction);\n    dist = this.distance(p1[0], p1[1], p2[0], p2[1]);\n    if (this.getIR(1) < 1.0) {\n      stroke(255);\n    }\n    fill(128, 0, 128, 64);\n    arc(p1[0], p1[1], dist * 2, dist * 2, \n    this.direction - .5, this.direction + .5);\n  }\n}\n\n\n\nRobot robot;\nWorld world;\nint mx, my;\n\nclass MyRobot extends Robot {\n    MyRobot(float x, float y, float r) {\n        super(x, y, r);\n        this.state = "start turn left";\n    }\n\n    void brain() {\n        PImage pic = this.takePicture();\n        // Show pic on canvas:\n        image(pic, 500 - 256, 250);\n        fill(0);\n        text("getIR(0): " + nf(this.getIR(0), 1, 4), 0, 265);\n        text("getIR(1): " + nf(this.getIR(1), 1, 4), 0, 280);\n        text("stalled: " + this.stalled, 0, 295);\n        text("state: " + this.state, 0, 310);\n        text("time: " + this.time, 0, 325);\n        \n        // brain:\n        \n        float speed = 3.0;\n        if (this.state == "backward") {\n            if (this.stalled) {\n                this.state = "forward";\n                this.forward(speed);\n            } else {\n                this.backward(speed);\n            }\n        } else if (this.state == "forward") {\n            if (this.stalled) {\n                this.state = "backward";\n                this.backward(speed);\n            } else {\n                this.forward(speed);\n            }\n        } else if (this.state == "start turn left") {\n            this.time = 62;\n            this.state = "turn left";\n        } else if (this.state == "turn left") {\n            if (this.time < 0) {\n                this.turn(0);\n                this.state = "forward";\n            } else {\n                this.turn(.05);\n                this.time -= 1;\n            }\n        } else if (this.state == "turn right") {\n            this.turn(-.05);\n        } else if (this.state == "stop") {\n            //this.stop();\n        }\n    }\n}\n\nvoid setup() {\n    // Set up canvas 500, 250 for World, 128 for camera:\n    size(500, 250 + 128);\n    // Set rate so it doesn\'t overwhelm your browser:\n    frameRate(10);\n    // Create a simulated world:\n    world = new World(500, 250);\n    world.addWall(100, 0, 110, 110);  \n    world.addBox(200, 95, 210, 170, color(255, 0, 255));  \n    world.addBox(300, 10, 310, 95, color(255, 255, 0));  \n    world.addBox(300, 190, 310, 240, color(255, 128, 0));  \n    // Create robot, and add to world:\n    robot = new MyRobot(400, 100, 0);\n    world.addRobot(robot);\n}\n\nvoid draw() {\n    // Clear:\n    background(255);\n    // Run simulation for one step:\n    world.update();\n}';
    var cc;
    var processingInstance;
    var has_error = false;
    try {
        cc = Processing.compile(processingCode);
    } catch (e) {
        console.log(e);
        cc = Processing.compile("println('" + e.toString() + "');");
        document.getElementById("state_2").innerHTML = e.toString();
        document.getElementById("state_2").style.color = "red";
        has_error = true;
    }
    if (cc != undefined) {
        try {
            processingInstance = new Processing("canvas_2", cc);
        } catch (e) {
            console.log(e);
            cc = Processing.compile("println('" + e.toString() + "');");
            document.getElementById("state_2").innerHTML = e.toString();
            document.getElementById("state_2").style.color = "red";
            processingInstance = new Processing("canvas_2", cc);
            has_error = true;
        }
    }
    if (processingInstance != undefined) {
        setTimeout(function () {
            // Canvas:
            if (processingInstance.externals.context === undefined) {
                document.getElementById("canvas_div_2").style.display = "none";
            }
        }, 100);
        // Controls:
        if (!(processingInstance.isRunning() && processingInstance.draw != undefined)) {
            document.getElementById("controls_div_2").style.display = "none";
        }
        if (processingInstance.draw != undefined) {
            if (!has_error) {
                document.getElementById("state_2").innerHTML = "Running...";
                document.getElementById("state_2").style.color = "green";
            }
            change_button(document.getElementById("run_button_2"), true);
            change_button(document.getElementById("pause_button_2"), false);
            change_button(document.getElementById("setup_button_2"),  true);
            change_button(document.getElementById("draw_button_2"), true);
        } else {
            if (!has_error) {
                document.getElementById("state_2").innerHTML = "Done.";
                document.getElementById("state_2").style.color = "blue";
            }
            change_button(document.getElementById("run_button_2"), true);
            change_button(document.getElementById("pause_button_2"), true);
            change_button(document.getElementById("setup_button_2"),  processingInstance.setup == undefined);
            change_button(document.getElementById("draw_button_2"), true);
        }
    } else {
        document.getElementById("canvas_div_2").style.display = "none";
        document.getElementById("controls_div_2").style.display = "none";
        if (!has_error) {
            document.getElementById("state_2").innerHTML = "Error.";
            document.getElementById("state_2").style.color = "red";
        }
        change_button(document.getElementById("run_button_2"), true);
        change_button(document.getElementById("pause_button_2"), true);
        change_button(document.getElementById("setup_button_2"),  true);
        change_button(document.getElementById("draw_button_2"), true);
    }
});

</script></div>
</div>
<p><strong>Your assignment</strong> is to write a program that will drive your robot forward into the “garage” and stop. The garage is the upper, left-hand corner of the world. You can use <code class="docutils literal notranslate"><span class="pre">this.time</span></code> when turning and moving backward, but you should use your sensors when moving forward.</p>
</div>
</div>
<p>Prepared to support updates to TM129 <a class="reference external" href="http://www.open.ac.uk/courses/modules/tm129">tm129</a>.</p>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2019, The Open University.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/demos/Jyro_processing_port_demo.ipynb"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>